--- pwlib/make/common.mak.orig	2003-02-03 07:08:52.000000000 +0100
+++ pwlib/make/common.mak	2003-07-12 23:41:53.000000000 +0200
@@ -339,6 +339,7 @@
 	$(LD)   --split-by-reloc 65535 -r   $(OBJS) -o $@ 
 endif
 
+ifdef PWLIB_BUILD
 ifdef DEBUG
 
 ifneq (,$(wildcard $(PWLIBDIR)/src/ptlib/unix))
@@ -364,6 +365,7 @@
 endif
 
 endif
+endif
 
 CLEAN_FILES += $(TARGET)
 
--- pwlib/make/gui.mak.orig	2001-06-15 02:58:00.000000000 +0200
+++ pwlib/make/gui.mak	2003-07-12 23:42:53.000000000 +0200
@@ -64,11 +64,11 @@
 #
 
 
-include $(PWLIBDIR)/make/defaultgui.mak
+include $(PWLIBMAKEDIR)/defaultgui.mak
 
 ifneq (,$(GUI_TYPE))
 
-include $(PWLIBDIR)/make/$(GUI_TYPE).mak
+include $(PWLIBMAKEDIR)/$(GUI_TYPE).mak
 
 ifndef	GUI_SRC_NAME
 GUI_SRC_NAME	= $(GUI_TYPE)
--- pwlib/make/ptlib.mak.orig	1998-12-02 03:37:31.000000000 +0100
+++ pwlib/make/ptlib.mak	2003-07-12 23:44:42.000000000 +0200
@@ -35,10 +35,13 @@
 #
 
 ifndef PWLIBDIR
-PWLIBDIR=$(HOME)/pwlib
+PWLIBDIR=/usr
+endif
+ifndef PWLIBMAKEDIR
+PWLIBMAKEDIR=/usr/share/pwlib/make
 endif
 
-include $(PWLIBDIR)/make/unix.mak
-include $(PWLIBDIR)/make/common.mak
+include $(PWLIBMAKEDIR)/unix.mak
+include $(PWLIBMAKEDIR)/common.mak
 
 # End of ptlib.mak
--- pwlib/make/pwlib.mak.orig	1998-12-02 03:39:53.000000000 +0100
+++ pwlib/make/pwlib.mak	2003-07-12 23:45:21.000000000 +0200
@@ -44,11 +44,14 @@
 #
 
 ifndef PWLIBDIR
-PWLIBDIR=$(HOME)/pwlib
+PWLIBDIR=/usr
+endif
+ifndef PWLIBMAKEDIR
+PWLIBMAKEDIR=/usr/share/pwlib/make
 endif
 
-include $(PWLIBDIR)/make/unix.mak
-include $(PWLIBDIR)/make/gui.mak
-include $(PWLIBDIR)/make/common.mak
+include $(PWLIBMAKEDIR)/unix.mak
+include $(PWLIBMAKEDIR)/gui.mak
+include $(PWLIBMAKEDIR)/common.mak
 
 # End of pwlib.mak
--- pwlib/make/unix.mak.orig	Thu Feb 26 12:19:07 2004
+++ pwlib/make/unix.mak	Wed Mar 17 15:06:05 2004
@@ -100,13 +100,16 @@
 #
 
 ifndef PWLIBDIR
-PWLIBDIR = $(HOME)/pwlib
+PWLIBDIR=/usr
+endif
+ifndef PWLIBMAKEDIR
+PWLIBMAKEDIR=/usr/share/pwlib/make
 endif
 
 ####################################################
 
 # include generated build options file, then include it
-include $(PWLIBDIR)/make/ptbuildopts.mak
+include $(PWLIBMAKEDIR)/ptbuildopts.mak
 
 ###############################################################################
 #
@@ -329,10 +332,6 @@
 # any -W overrides won't have any effect
 STDCCFLAGS += -Wall 
 
-ifdef RPM_OPT_FLAGS
-STDCCFLAGS	+= $(RPM_OPT_FLAGS)
-endif
-
 ifneq ($(OSTYPE),rtems)
 ifndef SYSINCDIR
 SYSINCDIR := /usr/include
@@ -379,7 +378,7 @@
 
 
 STATIC_LIBS	:= libstdc++.a libg++.a libm.a libc.a
-SYSLIBDIR	:= $(shell $(PWLIBDIR)/make/ptlib-config --libdir)
+SYSLIBDIR	:= $(shell $(PWLIBDIR)/bin/ptlib-config --libdir)
 
 endif # linux
 
@@ -872,7 +870,7 @@
 endif
 
 ifndef INSTALLLIB_DIR
-INSTALLLIB_DIR	= $(INSTALL_DIR)/lib
+INSTALLLIB_DIR	= $(subst $(PWLIBDIR),$(INSTALL_DIR),$(SYSLIBDIR))
 endif
 
 
@@ -899,7 +897,7 @@
 UNIX_SRC_DIR	= $(PWLIBDIR)/src/ptlib/unix
 endif
 
-PW_LIBDIR	= $(PWLIBDIR)/lib
+PW_LIBDIR	= $(SYSLIBDIR)
 
 # set name of the PT library
 PTLIB_BASE	= pt
@@ -947,7 +945,7 @@
 # define ESDDIR variables if installed
 ifdef  ESDDIR
 STDCCFLAGS	+= -I$(ESDDIR)/include -DUSE_ESD=1
-ENDLDLIBS	+= $(ESDDIR)/lib/libesd.a  # to avoid name conflicts
+ENDLDLIBS	+= -lesd
 HAS_ESD		= 1
 endif
 
--- pwlib/make/ptbuildopts.mak.in.orig	2003-07-25 00:01:42.000000000 +0200
+++ pwlib/make/ptbuildopts.mak.in	2003-09-03 08:20:46.772784632 +0200
@@ -2,7 +2,7 @@
 #
 
 ifndef PWLIBDIR
-PWLIBDIR   = @PWLIBDIR@
+PWLIBDIR   = @INSTALLPREFIX@
 endif
 
 MACHTYPE   = @MACHTYPE@
@@ -11,7 +11,6 @@
 
 STDCCFLAGS    += @STDCCFLAGS@
 OPTSTDCCFLAGS += @OPTSTDCCFLAGS@
-LDFLAGS	      += @LDFLAGS@
 ENDLDLIBS     += @ENDLDLIBS@
 
 HAS_OPENSSL	= @HAS_OPENSSL@
--- pwlib-1.8.4/make/ptlib-config.in.orig	2004-08-22 06:22:18.000000000 +0200
+++ pwlib-1.8.4/make/ptlib-config.in	2005-03-25 00:08:28.028391464 +0100
@@ -6,10 +6,10 @@
 
 VERSION="@PWLIB_VERSION@"
 CCFLAGS="@STDCCFLAGS@"
-LDFLAGS="@LDFLAGS@"
+LDFLAGS=
 LIBS="@ENDLDLIBS@"
 LIBDIR="@LIBDIR@"
-PWINSTDIR="@INSTALLPREFIX@/share/pwlib"
+PWINSTDIR="@INSTALLPREFIX@"
 MACHTYPE="@MACHTYPE@"
 OSTYPE="@OSTYPE@"
 OSRELEASE="@OSRELEASE@"
--- pwlib-1.8.4/Makefile.in.orig	2004-06-24 14:46:48.000000000 +0200
+++ pwlib-1.8.4/Makefile.in	2005-03-25 20:25:26.716863536 +0100
@@ -250,30 +250,18 @@
                      $(DESTDIR)$(PREFIX)/share/pwlib/make ; \
 		do mkdir -p $$dir ; chmod 755 $$dir ; \
 	done )
-	$(INSTALL) -m 444 lib/$(PTLIB_FILE).@MAJOR_VERSION@.@MINOR_VERSION@.@BUILD_NUMBER@ $(DESTDIR)$(LIBDIR)
-	(cd $(DESTDIR)$(LIBDIR) ; \
-		rm -f  $(PTLIB_FILE).@MAJOR_VERSION@.@MINOR_VERSION@ ; \
-		ln -sf $(PTLIB_FILE).@MAJOR_VERSION@.@MINOR_VERSION@.@BUILD_NUMBER@ $(PTLIB_FILE).@MAJOR_VERSION@.@MINOR_VERSION@ \
-	)
-	(cd $(DESTDIR)$(LIBDIR) ; \
-		rm -f  $(PTLIB_FILE).@MAJOR_VERSION@ ; \
-		ln -sf $(PTLIB_FILE).@MAJOR_VERSION@.@MINOR_VERSION@.@BUILD_NUMBER@ $(PTLIB_FILE).@MAJOR_VERSION@ \
-	)
+	$(INSTALL) lib/$(PTLIB_FILE).@MAJOR_VERSION@.@MINOR_VERSION@.@BUILD_NUMBER@ $(DESTDIR)$(LIBDIR)
 	(cd $(DESTDIR)$(LIBDIR) ; \
 		rm -f  $(PTLIB_FILE) ; \
 		ln -sf $(PTLIB_FILE).@MAJOR_VERSION@.@MINOR_VERSION@.@BUILD_NUMBER@ $(PTLIB_FILE) \
 	)
-	(cd $(DESTDIR)$(LIBDIR); \
-		rm -f  libpt.@SHAREDLIBEXT@ ; \
-		ln -sf $(PTLIB_FILE) libpt.@SHAREDLIBEXT@ \
-	)
 ifeq (1, $(HAS_PLUGINS))
 	cd plugins/pwlib/device/ ; \
 	( for dir in ./* ;\
 		do mkdir -p $(DESTDIR)$(LIBDIR)/pwlib/devices/$$dir ; \
 		chmod 755 $(DESTDIR)$(LIBDIR)/pwlib/devices/$$dir ; \
 		(for fn in ./$$dir/*.so ; \
-			do $(INSTALL) -m 444 $$fn $(DESTDIR)$(LIBDIR)/pwlib/devices/$$dir; \
+			do $(INSTALL) $$fn $(DESTDIR)$(LIBDIR)/pwlib/devices/$$dir; \
 		done ); \
 	done )
 endif
@@ -291,8 +279,7 @@
 	(for fn in make/*.mak ; \
 		do $(INSTALL) -m 444 $$fn $(DESTDIR)$(PREFIX)/share/pwlib/make; \
 	done)
-	$(INSTALL) -m 755 make/ptlib-config $(DESTDIR)$(PREFIX)/share/pwlib/make/
-	(cd $(DESTDIR)$(PREFIX)/bin; rm -f ptlib-config ; ln -snf ../share/pwlib/make/ptlib-config ptlib-config)
+	$(INSTALL) -m 755 make/ptlib-config $(DESTDIR)$(PREFIX)/bin
 
 uninstall:
 	rm -rf $(DESTDIR)$(PREFIX)/include/ptlib \
